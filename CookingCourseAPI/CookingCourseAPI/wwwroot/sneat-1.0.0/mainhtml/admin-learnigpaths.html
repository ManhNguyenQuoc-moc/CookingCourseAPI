<!DOCTYPE html>
<!-- ... (your existing head content) ... -->
<head>
    <meta charset="utf-8" />
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

    <title>Quản Lý Lộ Trình | Cooking Admin</title>

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/img/favicon/favicon.ico" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
          rel="stylesheet" />

    <!-- Icons. Uncomment required icon fonts -->
    <link rel="stylesheet" href="../assets/vendor/fonts/boxicons.css" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="../assets/vendor/css/core.css" class="template-customizer-core-css" />
    <link rel="stylesheet" href="../assets/vendor/css/theme-default.css" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="../assets/css/demo.css" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />

    <link rel="stylesheet" href="../assets/vendor/libs/apex-charts/apex-charts.css" />

    <!-- Page CSS -->
    <!-- Helpers -->
    <script src="../assets/vendor/js/helpers.js"></script>

    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="../assets/js/config.js"></script>
    <style>
        .card-actions {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            z-index: 10;
        }

            .card-actions .btn {
                margin-left: 0.25rem;
            }

        .course-in-detail-modal {
            border-bottom: 1px solid #eee;
            padding-bottom: 1rem;
            margin-bottom: 1rem;
        }

            .course-in-detail-modal:last-child {
                border-bottom: none;
                margin-bottom: 0;
            }
    </style>
</head>
<body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
        <div class="layout-container">
            <!-- Menu -->
            <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
                <!-- ... (your existing menu code as provided previously) ... -->
                <div class="app-brand demo">
                    <a href="admin.html" class="app-brand-link">
                        <span class="app-brand-logo demo">
                            <svg width="25"
                                 viewBox="0 0 25 42"
                                 version="1.1"
                                 xmlns="http://www.w3.org/2000/svg"
                                 xmlns:xlink="http://www.w3.org/1999/xlink">
                                <defs>
                                    <path d="M13.7918663,0.358365126 L3.39788168,7.44174259 C0.566865006,9.69408886 -0.379795268,12.4788597 0.557900856,15.7960551 C0.68998853,16.2305145 1.09562888,17.7872135 3.12357076,19.2293357 C3.8146334,19.7207684 5.32369333,20.3834223 7.65075054,21.2172976 L7.59773219,21.2525164 L2.63468769,24.5493413 C0.445452254,26.3002124 0.0884951797,28.5083815 1.56381646,31.1738486 C2.83770406,32.8170431 5.20850219,33.2640127 7.09180128,32.5391577 C8.347334,32.0559211 11.4559176,30.0011079 16.4175519,26.3747182 C18.0338572,24.4997857 18.6973423,22.4544883 18.4080071,20.2388261 C17.963753,17.5346866 16.1776345,15.5799961 13.0496516,14.3747546 L10.9194936,13.4715819 L18.6192054,7.984237 L13.7918663,0.358365126 Z"
                                          id="path-1"></path>
                                    <path d="M5.47320593,6.00457225 C4.05321814,8.216144 4.36334763,10.0722806 6.40359441,11.5729822 C8.61520715,12.571656 10.0999176,13.2171421 10.8577257,13.5094407 L15.5088241,14.433041 L18.6192054,7.984237 C15.5364148,3.11535317 13.9273018,0.573395879 13.7918663,0.358365126 C13.5790555,0.511491653 10.8061687,2.3935607 5.47320593,6.00457225 Z"
                                          id="path-3"></path>
                                    <path d="M7.50063644,21.2294429 L12.3234468,23.3159332 C14.1688022,24.7579751 14.397098,26.4880487 13.008334,28.506154 C11.6195701,30.5242593 10.3099883,31.790241 9.07958868,32.3040991 C5.78142938,33.4346997 4.13234973,34 4.13234973,34 C4.13234973,34 2.75489982,33.0538207 2.37032616e-14,31.1614621 C-0.55822714,27.8186216 -0.55822714,26.0572515 -4.05231404e-15,25.8773518 C0.83734071,25.6075023 2.77988457,22.8248993 3.3049379,22.52991 C3.65497346,22.3332504 5.05353963,21.8997614 7.50063644,21.2294429 Z"
                                          id="path-4"></path>
                                    <path d="M20.6,7.13333333 L25.6,13.8 C26.2627417,14.6836556 26.0836556,15.9372583 25.2,16.6 C24.8538077,16.8596443 24.4327404,17 24,17 L14,17 C12.8954305,17 12,16.1045695 12,15 C12,14.5672596 12.1403557,14.1461923 12.4,13.8 L17.4,7.13333333 C18.0627417,6.24967773 19.3163444,6.07059163 20.2,6.73333333 C20.3516113,6.84704183 20.4862915,6.981722 20.6,7.13333333 Z"
                                          id="path-5"></path>
                                </defs>
                                <g id="g-app-brand" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                    <g id="Brand-Logo" transform="translate(-27.000000, -15.000000)">
                                        <g id="Icon" transform="translate(27.000000, 15.000000)">
                                            <g id="Mask" transform="translate(0.000000, 8.000000)">
                                                <mask id="mask-2" fill="white">
                                                    <use xlink:href="#path-1"></use>
                                                </mask>
                                                <use fill="#696cff" xlink:href="#path-1"></use>
                                                <g id="Path-3" mask="url(#mask-2)">
                                                    <use fill="#696cff" xlink:href="#path-3"></use>
                                                    <use fill-opacity="0.2" fill="#FFFFFF" xlink:href="#path-3"></use>
                                                </g>
                                                <g id="Path-4" mask="url(#mask-2)">
                                                    <use fill="#696cff" xlink:href="#path-4"></use>
                                                    <use fill-opacity="0.2" fill="#FFFFFF" xlink:href="#path-4"></use>
                                                </g>
                                            </g>
                                            <g id="Triangle"
                                               transform="translate(19.000000, 11.000000) rotate(-300.000000) translate(-19.000000, -11.000000) ">
                                                <use fill="#696cff" xlink:href="#path-5"></use>
                                                <use fill-opacity="0.2" fill="#FFFFFF" xlink:href="#path-5"></use>
                                            </g>
                                        </g>
                                    </g>
                                </g>
                            </svg>
                        </span>
                        <span class="app-brand-text demo menu-text fw-bolder ms-2">Cooking</span>
                    </a>

                    <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto d-block d-xl-none">
                        <i class="bx bx-chevron-left bx-sm align-middle"></i>
                    </a>
                </div>
                <div class="menu-inner-shadow"></div>
                <ul class="menu-inner py-1">
                    <!-- Trang chủ -->
                    <li class="menu-item">
                        <a href="admin.html" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-home-circle"></i>
                            <div data-i18n="menu.home">Trang chủ</div>
                        </a>
                    </li>
                    <!-- Quan li Lộ trình -->
                    <li class="menu-item active">
                        <a href="admin-learnigpaths.html" class="menu-link">
                            <!-- Assuming this is the current page -->
                            <i class="menu-icon tf-icons bx bx-map"></i>
                            <div data-i18n="menu.roadmap">Quản Lý lộ trình</div>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="coursemanager.html" class="menu-link">
                            <i class="menu-icon tf-icons bx bxs-book-bookmark"></i> <!-- Changed icon -->
                            <div data-i18n="menu.coursemanager">Quản Lý khóa học</div>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="news-manager.html" class="menu-link">
                            <!-- Assuming a page for news management -->
                            <i class="menu-icon tf-icons bx bxs-news"></i> <!-- Changed icon -->
                            <div data-i18n="menu.newsmanager">Quản Lý Bản tin</div>
                        </a>
                    </li>
                    <!-- Bài viết -->
                    <li class="menu-item">
                        <a href="page-blogs.html" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-book-content"></i>
                            <div data-i18n="menu.posts">Bài viết</div>
                        </a>
                    </li>
                    <!-- Header: Bản tin khóa học -->
                    <li class="menu-header small text-uppercase">
                        <span class="menu-header-text" data-i18n="menu.news-header">Bản tin khóa học</span>
                    </li>
                    <li class="menu-item">
                        <a class="menu-link" href="#" data-bs-toggle="modal" data-bs-target="#newsModal">
                            <i class="menu-icon tf-icons bx bx-news"></i>
                            <div data-i18n="menu.news">Bản tin</div>
                        </a>
                    </li>
                    <li class="menu-header small text-uppercase">
                        <span class="menu-header-text">Pages</span>
                    </li>
                    <li class="menu-item">
                        <a href="javascript:void(0);" class="menu-link menu-toggle">
                            <i class="menu-icon tf-icons bx bx-dock-top"></i>
                            <div data-i18n="Account Settings">Account Settings</div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item">
                                <!-- Removed 'active' if this is not the account settings page -->
                                <a href="pages-account-settings-account.html" class="menu-link">
                                    <div data-i18n="Account">Account</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="account-manager.html" class="menu-link">
                                    <div data-i18n="Account">Quản lý tài khoản người dùng</div>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="menu-item">
                        <a href="javascript:void(0);" class="menu-link menu-toggle">
                            <i class="menu-icon tf-icons bx bx-lock-open-alt"></i>
                            <div data-i18n="Authentications">Authentications</div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item">
                                <!-- Removed 'active' -->
                                <a href="auth-forgot-password-basic.html" class="menu-link" target="_blank">
                                    <div data-i18n="Basic">Forgot Password</div>
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </aside>
            <!-- / Menu -->
            <!-- Modal: Hiển thị bản tin (existing)-->
            <div class="modal fade" id="newsModal" tabindex="-1" role="dialog" aria-labelledby="newsModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="newsModalLabel">Bản tin hôm nay</h5>
                        </div>
                        <div class="modal-body">
                            <img src="https://via.placeholder.com/800x300" class="img-fluid mb-3" alt="Tin tức">
                            <p>Đây là nội dung bản tin chi tiết, bạn có thể cập nhật bằng nội dung thật sự hoặc load động.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Layout container -->
            <div class="layout-page">
                <!-- Navbar -->
                <nav class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
                     id="layout-navbar">
                    <!-- ... (existing navbar as provided previously) ... -->
                    <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
                        <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)">
                            <i class="bx bx-menu bx-sm"></i>
                        </a>
                    </div>
                    <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
                        <!-- Search -->
                        <div class="navbar-nav align-items-center">
                            <div class="nav-item d-flex align-items-center">
                                <i class="bx bx-search fs-4 lh-0"></i>
                                <input type="text"
                                       class="form-control border-0 shadow-none"
                                       placeholder="Search..."
                                       aria-label="Search..." />
                            </div>
                        </div>
                        <!-- /Search -->
                        <ul class="navbar-nav flex-row align-items-center ms-auto">
                            <!-- Place this tag where you want the button to render. -->
                            <!-- Khóa học của tôi -->
                            <li class="nav-item me-3">
                                <h5 class="mb-0"><a href="#" class="text-gray">Khóa học của tôi</a></h5>
                            </li>
                            <!-- Chuông thông báo -->
                            <li class="nav-item dropdown me-3">
                                <button type="button"
                                        id="loginNofica"
                                        class="btn rounded-pill btn-icon btn-outline-secondary dropdown-toggle"
                                        data-bs-toggle="dropdown"
                                        aria-haspopup="true"
                                        aria-expanded="false">
                                    <span class="tf-icons bx bx-bell"></span>
                                </button>
                                <div class="dropdown-menu dropdown-menu-end p-3" aria-labelledby="loginNofica" style="min-width: 300px; max-height: 400px; overflow-y: auto;">
                                    <h6 class="dropdown-header">Thông báo</h6>
                                    <div id="notificationList">
                                        <p class="text-muted mb-0">Không có thông báo nào.</p>
                                    </div>
                                </div>
                            </li>

                            <li class="nav-item">
                                <button id="loginBtn" class="btn btn-primary rounded-circle d-flex align-items-center justify-content-center"
                                        type="button" style="width: 40px; height: 40px;">
                                    <i class="fas fa-user"></i>
                                </button>
                            </li>
                            <!-- User -->
                            <li id="userDropdown" class="nav-item navbar-dropdown dropdown-user dropdown d-none">
                                <a class="nav-link dropdown-toggle hide-arrow" href="javascript:void(0);" data-bs-toggle="dropdown">
                                    <div id="btnShowProfile" class="avatar avatar-online">
                                        <img id="avataruser1" src="../assets/img/avatars/1.png" alt class="w-px-40 h-auto rounded-circle" />
                                    </div>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li>
                                        <a class="dropdown-item" href="#">
                                            <div class="d-flex">
                                                <div class="flex-shrink-0 me-3">
                                                    <div class="avatar avatar-online">
                                                        <img id="useravatar" src="../assets/img/avatars/1.png" alt class="w-px-40 h-auto rounded-circle" />
                                                    </div>
                                                </div>
                                                <div class="flex-grow-1">
                                                    <span id="nameuser" class="fw-semibold d-block">John Doe</span>
                                                    <small id="roleuser" class="text-muted">Admin</small>
                                                </div>
                                            </div>
                                        </a>
                                    </li>
                                    <li>
                                        <div class="dropdown-divider"></div>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="pages-account-settings-account.html">
                                            <i class="bx bx-user me-2"></i>
                                            <span class="align-middle">Trang cá nhân</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#">
                                            <i class="fa-solid fa-pen me-2"></i>
                                            <span class="align-middle">Viết blog</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#">
                                            <i class="fa-solid fa-file me-2"></i>
                                            <span class="align-middle">Bài viết của tôi</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#">
                                            <i class="fa-solid fa-floppy-disk me-2"></i>
                                            <span class="align-middle">Bài viết đã lưu</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#">
                                            <i class="bx bx-cog me-2"></i>
                                            <span class="align-middle">Cài đặt</span>
                                        </a>
                                    </li>

                                    <li>
                                        <div class="dropdown-divider"></div>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="auth-login-basic.html">
                                            <i class="bx bx-power-off me-2"></i>
                                            <span id="logoutBtn" class="align-middle">Đăng xuất</span>
                                        </a>
                                    </li>
                                </ul>
                            </li>
                            <!--/ User -->
                        </ul>
                    </div>
                </nav>
                <style>
                    #loginNofica::after {
                        display: none !important;
                    }
                </style>
                <!-- /Navbar -->
                <!-- Content wrapper -->
                <div class="content-wrapper">
                    <!-- Content -->
                    <div class="container-xxl flex-grow-1 container-p-y">
                        <h4 class="fw-bold py-3 mb-4"><span class="text-muted fw-light">Lộ trình học nấu ăn /</span> Các lộ trình</h4>

                        <div class="_container-top_juuyp_10">
                            <!-- ... (existing intro text) ... -->
                        </div>

                        <div class="d-flex justify-content-end mb-3">
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addLearningPathModal">
                                <i class="bx bx-plus me-1"></i> Thêm Lộ trình học
                            </button>
                        </div>

                        <div class="row mb-5" id="learningPathsDisplayArea">
                            <p class="text-center col-12">Đang tải danh sách lộ trình học...</p>
                        </div>

                        <div class="_wrapper_669bc_1">
                            <!-- ... (existing "Tham gia cộng đồng" section) ... -->
                        </div>
                    </div>
                    <!-- / Content -->
                    <!-- Footer -->
                    <!-- ... (existing footer as provided previously) ... -->
                    <footer class="bg-light text-dark pt-5 pb-3 border-top">
                        <div class="container-xxl">
                            <div class="row">
                                <!-- Thông tin liên hệ -->
                                <div class="col-md-4 mb-4">
                                    <h5 class="fw-bold text-primary">Cooking Master</h5>
                                    <p class="small mb-2">
                                        Điện thoại: 08 1919 1234<br>
                                        Email: contact@cookingmaster.vn<br>
                                        Địa chỉ: Số 123, Đường Ẩm Thực, Quận 1, TP. Hồ Chí Minh
                                    </p>
                                    <img src="https://png.pngtree.com/png-clipart/20230914/original/pngtree-bakery-tool-clipart-hand-drawn-illustration-food-items-and-cooking-concepts-png-image_12149984.png"
                                         class="img-fluid rounded shadow-sm mt-2"
                                         style="max-height: 120px; object-fit: contain;" id="imageurl">
                                </div>

                                <!-- Về Chúng Tôi -->
                                <div class="col-md-2 mb-4">
                                    <h6 class="fw-semibold text-primary">Về Chúng Tôi</h6>
                                    <ul class="list-unstyled small">
                                        <li><a href="#" class="footer-link">Giới thiệu</a></li>
                                        <li><a href="#" class="footer-link">Liên hệ</a></li>
                                        <li><a href="#" class="footer-link">Điều khoản</a></li>
                                        <li><a href="#" class="footer-link">Chính sách bảo mật</a></li>
                                    </ul>
                                </div>

                                <!-- Khóa Học -->
                                <div class="col-md-3 mb-4">
                                    <h6 class="fw-semibold text-primary">Khóa Học</h6>
                                    <ul class="list-unstyled small">
                                        <li><a href="#" class="footer-link">Nấu ăn cơ bản</a></li>
                                        <li><a href="#" class="footer-link">Bếp Âu chuyên nghiệp</a></li>
                                        <li><a href="#" class="footer-link">Pha chế đồ uống</a></li>
                                        <li><a href="#" class="footer-link">Trang trí món ăn</a></li>
                                        <li><a href="#" class="footer-link">Khóa học làm bánh</a></li>
                                    </ul>
                                </div>

                                <!-- Công Cụ -->
                                <div class="col-md-3 mb-4">
                                    <h6 class="fw-semibold text-primary">Công Cụ</h6>
                                    <ul class="list-unstyled small">
                                        <li><a href="#" class="footer-link">Công thức nấu ăn</a></li>
                                        <li><a href="#" class="footer-link">Tạo thực đơn</a></li>
                                    </ul>
                                </div>
                            </div>

                            <hr>

                            <!-- Bản quyền & mạng xã hội -->
                            <div class="d-flex justify-content-between align-items-center flex-wrap small pt-3">
                                <div class="text-muted">
                                    ©
                                    <script>document.write(new Date().getFullYear());</script> Cooking Master. Nền tảng học nấu ăn hàng đầu Việt Nam.
                                </div>
                                <div>
                                    <a href="#" class="text-primary me-3 fs-5"><i class="fab fa-youtube"></i></a>
                                    <a href="#" class="text-primary me-3 fs-5"><i class="fab fa-facebook"></i></a>
                                    <a href="#" class="text-primary fs-5"><i class="fab fa-tiktok"></i></a>
                                </div>
                            </div>
                        </div>
                    </footer>

                    <style>
                        .footer-link {
                            color: #495057;
                            text-decoration: none;
                            transition: color 0.2s ease-in-out;
                        }

                            .footer-link:hover {
                                color: #0d6efd; /* Màu primary khi hover */
                                text-decoration: underline;
                            }

                        footer h5, footer h6 {
                            margin-bottom: 1rem;
                        }
                    </style>
                    <div class="content-backdrop fade"></div>
                </div>
                <!-- / Content wrapper -->
            </div>
            <!-- / Layout page -->
        </div>
        <div class="layout-overlay layout-menu-toggle"></div>
    </div>
    <!-- / Layout wrapper -->
    <!-- MODAL: Thêm Lộ trình học (existing) -->
    <div class="modal fade" id="addLearningPathModal" tabindex="-1" aria-labelledby="addLearningPathModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addLearningPathModalLabel">Thêm Lộ trình học mới</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addLearningPathForm">
                        <div class="mb-3">
                            <label for="learningPathTitle" class="form-label">Tiêu đề lộ trình <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="learningPathTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="learningPathDescription" class="form-label">Mô tả <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="learningPathDescription" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="learningPathImageUrl" class="form-label">Link ảnh bìa (tùy chọn)</label>
                            <input type="url" class="form-control" id="learningPathImageUrl" placeholder="https://example.com/image.jpg">
                        </div>
                        <h6 class="mt-4 mb-2">Chọn các khóa học <span class="text-danger">*</span>:</h6>
                        <div id="coursesListContainer" class="list-group border rounded" style="max-height: 300px; overflow-y: auto;">
                            <p class="text-center p-3">Đang tải danh sách khóa học...</p>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-primary" id="saveLearningPathBtn">Lưu lộ trình</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Sửa Lộ trình học (NEW) -->
    <div class="modal fade" id="editLearningPathModal" tabindex="-1" aria-labelledby="editLearningPathModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editLearningPathModalLabel">Chỉnh sửa Lộ trình học</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editLearningPathForm">
                        <input type="hidden" id="editLearningPathId">
                        <div class="mb-3">
                            <label for="editLearningPathTitle" class="form-label">Tiêu đề lộ trình <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="editLearningPathTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="editLearningPathDescription" class="form-label">Mô tả <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="editLearningPathDescription" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="editLearningPathImageUrl" class="form-label">Link ảnh bìa (tùy chọn)</label>
                            <input type="url" class="form-control" id="editLearningPathImageUrl" placeholder="https://example.com/image.jpg">
                        </div>
                        <h6 class="mt-4 mb-2">Chọn các khóa học <span class="text-danger">*</span>:</h6>
                        <div id="editCoursesListContainer" class="list-group border rounded" style="max-height: 300px; overflow-y: auto;">
                            <p class="text-center p-3">Đang tải danh sách khóa học...</p>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-primary" id="updateLearningPathBtn">Lưu thay đổi</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Chi tiết Lộ trình học (NEW) -->
    <div class="modal fade" id="learningPathDetailModal" tabindex="-1" aria-labelledby="learningPathDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <!-- modal-xl for wider modal -->
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="learningPathDetailModalLabel">Chi tiết Lộ trình học</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h4 id="detailLearningPathTitle" class="mb-3"></h4>
                    <div id="detailCoursesContainer" class="container-fluid">
                        <!-- Courses will be listed here -->
                        <p class="text-center p-3">Đang tải danh sách khóa học của lộ trình...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const API_BASE_URL = 'http://localhost:5043/api';

            // --- Globals and Helper Functions ---
            let allSystemCourses = []; // To cache all courses for reuse in modals

            // Function to get current user ID (replace with actual auth logic)
            function getCurrentUserId() {
                const storedUser = localStorage.getItem('user');
                if (storedUser) {
                    try {
                        const user = JSON.parse(storedUser);
                        if (user && user.id) return user.id;
                    } catch (e) { console.error("Error parsing user from localStorage", e); }
                }
                console.warn("User ID not found in localStorage, defaulting to 1. Ensure user is logged in and ID is stored.");
                return 1; // Fallback to a default if not found or error
            }
            const currentUserId = getCurrentUserId();


            // --- Modal Instances ---
            const addLearningPathModalEl = document.getElementById('addLearningPathModal');
            const addLearningPathModal = addLearningPathModalEl ? new bootstrap.Modal(addLearningPathModalEl) : null;

            const editLearningPathModalEl = document.getElementById('editLearningPathModal');
            const editLearningPathModal = editLearningPathModalEl ? new bootstrap.Modal(editLearningPathModalEl) : null;

            const learningPathDetailModalEl = document.getElementById('learningPathDetailModal');
            const learningPathDetailModal = learningPathDetailModalEl ? new bootstrap.Modal(learningPathDetailModalEl) : null;


            // --- DOM Elements for Modals & Forms ---
            const coursesListContainer = document.getElementById('coursesListContainer'); // For Add Modal
            const editCoursesListContainer = document.getElementById('editCoursesListContainer'); // For Edit Modal
            const detailCoursesContainer = document.getElementById('detailCoursesContainer'); // For Detail Modal
            const detailLearningPathTitleEl = document.getElementById('detailLearningPathTitle');

            const addLearningPathForm = document.getElementById('addLearningPathForm');
            const learningPathTitleInput = document.getElementById('learningPathTitle');
            const learningPathDescriptionInput = document.getElementById('learningPathDescription');
            const learningPathImageUrlInput = document.getElementById('learningPathImageUrl');
            const saveLearningPathBtn = document.getElementById('saveLearningPathBtn');

            const editLearningPathForm = document.getElementById('editLearningPathForm');
            const editLearningPathIdInput = document.getElementById('editLearningPathId');
            const editLearningPathTitleInput = document.getElementById('editLearningPathTitle');
            const editLearningPathDescriptionInput = document.getElementById('editLearningPathDescription');
            const editLearningPathImageUrlInput = document.getElementById('editLearningPathImageUrl');
            const updateLearningPathBtn = document.getElementById('updateLearningPathBtn');

            const learningPathsDisplayArea = document.getElementById('learningPathsDisplayArea');


            // --- Fetch All System Courses (cached) ---
            async function fetchAllSystemCourses() {
                if (allSystemCourses.length > 0) {
                    return allSystemCourses;
                }
                try {
                    const response = await fetch(`${API_BASE_URL}/Courses`);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const result = await response.json();
                    if (result.success && result.data && result.data.$values) {
                        allSystemCourses = result.data.$values;
                        return allSystemCourses;
                    } else {
                        console.error('Failed to fetch system courses:', result.message);
                        return [];
                    }
                } catch (error) {
                    console.error('Error fetching system courses:', error);
                    return [];
                }
            }

            // --- Render Courses in Checkbox List (for Add/Edit Modals) ---
            function renderCoursesForSelection(courses, containerElement, selectedCourseIds = []) {
                if (!courses || courses.length === 0) {
                    containerElement.innerHTML = '<p class="text-center p-3">Không có khóa học nào để hiển thị.</p>';
                    return;
                }
                containerElement.innerHTML = '';
                courses.forEach(course => {
                    const isChecked = selectedCourseIds.includes(course.id);
                    const courseItemHTML = `
                <label class="list-group-item d-flex align-items-center">
                    <input class="form-check-input me-2" type="checkbox" value="${course.id}" ${isChecked ? 'checked' : ''}>
                    <div class="flex-grow-1">
                        ${course.name}
                        <small class="d-block text-muted">${course.isFree ? 'Miễn phí' : (course.price ? course.price.toLocaleString() + ' VND' : 'Giá không xác định')}</small>
                    </div>
                    ${course.imageUrl ? `<img src="${course.imageUrl}" alt="${course.name}" style="width: 50px; height: 50px; object-fit: cover; margin-left: 10px; border-radius: 4px;">` : ''}
                </label>
            `;
                    containerElement.insertAdjacentHTML('beforeend', courseItemHTML);
                });
            }

            // --- ADD LEARNING PATH ---
            if (addLearningPathModalEl) {
                addLearningPathModalEl.addEventListener('show.bs.modal', async () => {
                    addLearningPathForm.reset();
                    coursesListContainer.innerHTML = '<p class="text-center p-3">Đang tải khóa học...</p>';
                    const courses = await fetchAllSystemCourses();
                    renderCoursesForSelection(courses, coursesListContainer);
                });
            }

            if (saveLearningPathBtn) {
                saveLearningPathBtn.addEventListener('click', async () => {
                    const title = learningPathTitleInput.value.trim();
                    const description = learningPathDescriptionInput.value.trim();
                    const imageUrl = learningPathImageUrlInput.value.trim() || null;
                    const selectedCourses = Array.from(coursesListContainer.querySelectorAll('input[type="checkbox"]:checked'));
                    const courseIds = selectedCourses.map(cb => parseInt(cb.value));

                    if (!title || !description || courseIds.length === 0) {
                        alert('Vui lòng nhập đầy đủ tiêu đề, mô tả và chọn ít nhất một khóa học.');
                        return;
                    }

                    const learningPathData = { title, description, courseIds, imageUrl };

                    try {
                        saveLearningPathBtn.disabled = true;
                        saveLearningPathBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Đang lưu...';
                        const response = await fetch(`${API_BASE_URL}/LearningPaths`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(learningPathData)
                        });
                        if (!response.ok) { // Check if response is NOT ok
                            const errorResult = await response.json().catch(() => ({ message: "Lỗi không xác định từ server." }));
                            throw new Error(errorResult.message || `Lỗi HTTP: ${response.status}`);
                        }
                        // Assuming success if response.ok is true, as per your controller returning Ok(path)
                        // For POST, it might return the created object.
                        // const result = await response.json(); // If you need to use the created object

                        alert('Thêm lộ trình học thành công!');
                        addLearningPathModal.hide();
                        fetchAndDisplayLearningPaths();
                    } catch (error) {
                        console.error('Error saving learning path:', error);
                        alert(`Lỗi khi lưu lộ trình: ${error.message}`);
                    } finally {
                        saveLearningPathBtn.disabled = false;
                        saveLearningPathBtn.innerHTML = 'Lưu lộ trình';
                    }
                });
            }

            // --- EDIT LEARNING PATH ---
            async function openEditModal(pathId) {
                if (!editLearningPathModal) return;
                editLearningPathForm.reset();
                editCoursesListContainer.innerHTML = '<p class="text-center p-3">Đang tải...</p>';
                try {
                    // 1. Fetch the specific learning path
                    const pathResponse = await fetch(`${API_BASE_URL}/LearningPaths/${pathId}`);
                    if (!pathResponse.ok) throw new Error(`Không thể tải dữ liệu lộ trình: ${pathResponse.status}`);
                    const learningPath = await pathResponse.json(); // Directly the object, not wrapped in {success, data}

                    if (!learningPath) throw new Error("Không tìm thấy lộ trình.");

                    // 2. Populate form fields
                    editLearningPathIdInput.value = learningPath.id;
                    editLearningPathTitleInput.value = learningPath.title || '';
                    editLearningPathDescriptionInput.value = learningPath.description || '';
                    editLearningPathImageUrlInput.value = learningPath.imageUrl || '';

                    // 3. Fetch all system courses and pre-select
                    const allCourses = await fetchAllSystemCourses();
                    const selectedCourseIds = learningPath.courseIds || [];
                    renderCoursesForSelection(allCourses, editCoursesListContainer, selectedCourseIds);

                    editLearningPathModal.show();
                } catch (error) {
                    console.error("Error opening edit modal:", error);
                    alert(`Lỗi: ${error.message}`);
                }
            }

            if (updateLearningPathBtn) {
                updateLearningPathBtn.addEventListener('click', async () => {
                    const id = parseInt(editLearningPathIdInput.value);
                    const title = editLearningPathTitleInput.value.trim();
                    const description = editLearningPathDescriptionInput.value.trim();
                    const imageUrl = editLearningPathImageUrlInput.value.trim() || null;
                    const selectedCourses = Array.from(editCoursesListContainer.querySelectorAll('input[type="checkbox"]:checked'));
                    const courseIds = selectedCourses.map(cb => parseInt(cb.value));

                    if (!id || !title || !description || courseIds.length === 0) {
                        alert('Vui lòng nhập đầy đủ tiêu đề, mô tả và chọn ít nhất một khóa học.');
                        return;
                    }

                    const learningPathData = { id, title, description, courseIds, imageUrl };

                    try {
                        updateLearningPathBtn.disabled = true;
                        updateLearningPathBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Đang cập nhật...';
                        const response = await fetch(`${API_BASE_URL}/LearningPaths/${id}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(learningPathData)
                        });
                        if (!response.ok) {
                            const errorResult = await response.json().catch(() => ({ message: "Lỗi không xác định từ server." }));
                            throw new Error(errorResult.message || `Lỗi HTTP: ${response.status}`);
                        }
                        // const result = await response.json(); // If PUT returns updated object
                        alert('Cập nhật lộ trình học thành công!');
                        editLearningPathModal.hide();
                        fetchAndDisplayLearningPaths();
                    } catch (error) {
                        console.error('Error updating learning path:', error);
                        alert(`Lỗi khi cập nhật lộ trình: ${error.message}`);
                    } finally {
                        updateLearningPathBtn.disabled = false;
                        updateLearningPathBtn.innerHTML = 'Lưu thay đổi';
                    }
                });
            }


            // --- DELETE LEARNING PATH ---
            async function deleteLearningPath(pathId, pathTitle) {
                if (!confirm(`Bạn có chắc chắn muốn xóa lộ trình "${pathTitle}" không? Hành động này không thể hoàn tác.`)) {
                    return;
                }
                try {
                    const response = await fetch(`${API_BASE_URL}/LearningPaths/${pathId}`, {
                        method: 'DELETE'
                    });
                    if (response.status === 204) { // NoContent
                        alert(`Đã xóa lộ trình "${pathTitle}" thành công.`);
                        fetchAndDisplayLearningPaths();
                    } else if (!response.ok) {
                        const errorResult = await response.json().catch(() => ({ message: "Lỗi không xác định khi xóa." }));
                        throw new Error(errorResult.message || `Lỗi HTTP: ${response.status}`);
                    } else {
                        alert(`Đã xóa lộ trình "${pathTitle}" thành công.`); // For APIs returning Ok() on delete
                        fetchAndDisplayLearningPaths();
                    }
                } catch (error) {
                    console.error('Error deleting learning path:', error);
                    alert(`Lỗi khi xóa lộ trình: ${error.message}`);
                }
            }


            // --- VIEW LEARNING PATH DETAILS (Courses in Path) ---
            async function openLearningPathDetailModal(pathId, pathTitle) {
                if (!learningPathDetailModal || !detailCoursesContainer || !detailLearningPathTitleEl) return;

                detailLearningPathTitleEl.textContent = pathTitle || "Chi tiết lộ trình";
                detailCoursesContainer.innerHTML = '<p class="text-center p-3">Đang tải các khóa học...</p>';
                learningPathDetailModal.show();

                try {
                    const pathResponse = await fetch(`${API_BASE_URL}/LearningPaths/${pathId}`);
                    if (!pathResponse.ok) throw new Error(`Không thể tải chi tiết lộ trình: ${pathResponse.status}`);
                    const learningPath = await pathResponse.json();

                    // Lấy courseIds từ learningPathCourses.$values
                    const learningPathCourses = learningPath.learningPathCourses?.$values || [];
                    const courseIds = learningPathCourses.map(item => item.courseId);

                    if (courseIds.length === 0) {
                        detailCoursesContainer.innerHTML = '<p class="text-center p-3">Lộ trình này chưa có khóa học nào.</p>';
                        return;
                    }

                    // Gửi request lấy chi tiết từng khóa học
                    const coursePromises = courseIds.map(courseId =>
                        fetch(`${API_BASE_URL}/Courses/${courseId}`).then(res => {
                            if (!res.ok) {
                                console.error(`Không thể tải khóa học ${courseId}: ${res.status}`);
                                return null;
                            }
                            return res.json();
                        })
                    );

                    const courseResults = await Promise.all(coursePromises);

                    // Lọc và trích thông tin cần thiết
                    const coursesInPath = courseResults
                        .filter(result => result && result.success && result.data)
                        .map(result => ({
                            id: result.data.id,
                            name: result.data.name,
                            description: result.data.description,
                            price: result.data.price,
                            isFree: result.data.isFree,
                            videos: result.data.videos ? result.data.videos.$values.map(video => ({
                                title: video.title,
                                url: video.url
                            })) : []
                        }));

                    renderCoursesInDetailModal(coursesInPath);

                } catch (error) {
                    console.error("Lỗi khi mở modal chi tiết lộ trình học:", error);
                    detailCoursesContainer.innerHTML = `<p class="text-danger text-center p-3">Lỗi tải khóa học: ${error.message}</p>`;
                }


            }

            function renderCoursesInDetailModal(courses) {
                if (!detailCoursesContainer) return;
                detailCoursesContainer.innerHTML = '';

                if (!courses || courses.length === 0) {
                    detailCoursesContainer.innerHTML = '<p class="text-center p-3">Không có khóa học nào trong lộ trình này hoặc không thể tải dữ liệu.</p>';
                    return;
                }

                const coursesHtml = courses.map(course => {
                    const priceDisplay = course.isFree ? '<span class="badge bg-success">Miễn phí</span>' : `<span class="badge bg-info">${course.price ? course.price.toLocaleString() + ' VND' : 'N/A'}</span>`;
                    const actionButton = course.isFree
                        ? `<button class="btn btn-success btn-sm start-learning-btn" data-course-id="${course.id}">Bắt đầu học</button>`
                        : `<button class="btn btn-primary btn-sm enroll-course-btn" data-course-id="${course.id}" data-course-price="${course.price}">Đăng kí học</button>`;

                    return `
                <div class="row course-in-detail-modal align-items-center">
                    <div class="col-md-2 text-center">
                        <img src="${course.imageUrl || 'https://png.pngtree.com/png-clipart/20220603/original/pngtree-classic-chef-cartoon-png-image_7899858.png'}" alt="${course.name}" class="img-fluid rounded" style="max-height: 80px; object-fit: cover;">
                    </div>
                    <div class="col-md-6">
                        <h6 class="mb-1">${course.name}</h6>
                        <p class="text-muted small mb-1" style="max-height: 40px; overflow: hidden; text-overflow: ellipsis;">${course.description || 'Không có mô tả.'}</p>
                    </div>
                    <div class="col-md-2 text-center">
                        ${priceDisplay}
                    </div>
                    <div class="col-md-2 text-center">
                        ${actionButton}
                    </div>
                </div>
            `;
                }).join('');
                detailCoursesContainer.innerHTML = coursesHtml;
            }

            // Handle "Start Learning" and "Enroll Course" button clicks within the detail modal
            if (detailCoursesContainer) {
                detailCoursesContainer.addEventListener('click', async (event) => {
                    const target = event.target;
                    const courseId = target.dataset.courseId;

                    if (target.classList.contains('start-learning-btn')) {
                        if (!courseId) return;
                        alert(`Bắt đầu học khóa học ID: ${courseId}. Chuyển hướng đến trang học...`);
                        window.location.href = `learning.html?courseId=${courseId}`; // Placeholder
                    }
                    else if (target.classList.contains('enroll-course-btn')) {
                        if (!courseId) return;
                        const coursePrice = target.dataset.coursePrice;
                        if (confirm(`Bạn có muốn đăng ký khóa học này với giá ${coursePrice ? parseInt(coursePrice).toLocaleString() : 'N/A'} VND không?`)) {
                            try {
                                target.disabled = true;
                                target.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';

                                const enrollDto = { userId: currentUserId, courseId: parseInt(courseId) };
                                const response = await fetch(`${API_BASE_URL}/Courses/enroll`, {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify(enrollDto)
                                });
                                const result = await response.json();
                                if (response.ok && result.success) {
                                    alert(result.message || "Đăng ký thành công! Chuyển đến trang học...");
                                    window.location.href = `learning.html?courseId=${courseId}`; // Placeholder
                                } else {
                                    alert(`Đăng ký thất bại: ${result.message || 'Lỗi không xác định.'}`);
                                }
                            } catch (error) {
                                console.error("Enrollment error:", error);
                                alert(`Lỗi khi đăng ký: ${error.message}`);
                            } finally {
                                target.disabled = false;
                                target.innerHTML = 'Đăng kí học';
                            }
                        }
                    }
                });
            }


            // --- DISPLAY LEARNING PATHS ON PAGE ---
            async function fetchAndDisplayLearningPaths() {
                if (!learningPathsDisplayArea) return;
                learningPathsDisplayArea.innerHTML = '<p class="text-center col-12 p-5">Đang tải danh sách lộ trình học...</p>';
                try {
                    const response = await fetch(`${API_BASE_URL}/LearningPaths`);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                    const result = await response.json(); // Expecting { $id, $values: [] } or direct array based on controller
                    let pathsToRender = [];

                    if (result && result.$values && Array.isArray(result.$values)) { // Handle {$id, $values} structure
                        pathsToRender = result.$values;
                    } else if (Array.isArray(result)) { // Handle direct array
                        pathsToRender = result;
                    } else {
                        console.warn("Learning paths data format not recognized.", result);
                        learningPathsDisplayArea.innerHTML = '<p class="text-center col-12 p-3">Không tìm thấy dữ liệu lộ trình học hợp lệ.</p>';
                        return;
                    }

                    renderLearningPathCards(pathsToRender);

                } catch (error) {
                    learningPathsDisplayArea.innerHTML = `<p class="text-danger text-center col-12 p-3">Lỗi khi tải lộ trình học: ${error.message}</p>`;
                    console.error('Error fetching learning paths:', error);
                }
            }

            function renderLearningPathCards(learningPaths) {
                learningPathsDisplayArea.innerHTML = '';
                if (!learningPaths || learningPaths.length === 0) {
                    learningPathsDisplayArea.innerHTML = '<p class="text-center col-12 p-5">Chưa có lộ trình học nào. Hãy thêm mới!</p>';
                    return;
                }
                learningPaths.forEach(path => {
                    const imageUrl = path.imageUrl || '../assets/img/elements/13.jpg'; // Default image
                    const courseCount = path.courseIds ? path.courseIds.length : (path.courses ? path.courses.length : 0);

                    // Ensure path.title is defined for data attributes
                    const pathTitleForAttr = path.title || "Không có tiêu đề";

                    const pathCardHTML = `
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100 shadow-sm position-relative">
                        <div class="card-actions">
                            <button class="btn btn-sm btn-outline-primary edit-lp-btn" title="Sửa" 
                                    data-path-id="${path.id}" data-bs-toggle="tooltip" data-bs-placement="top">
                                <i class="bx bx-edit-alt"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger delete-lp-btn" title="Xóa" 
                                    data-path-id="${path.id}" data-path-title="${pathTitleForAttr}" data-bs-toggle="tooltip" data-bs-placement="top">
                                <i class="bx bx-trash"></i>
                            </button>
                        </div>
                        <img class="card-img-top" src="${imageUrl}" alt="${pathTitleForAttr}" style="height: 200px; object-fit: cover; background-color: #e9ecef;">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">${path.title || 'Không có tiêu đề'}</h5>
                            <p class="card-text flex-grow-1 text-muted small">${path.description || 'Không có mô tả.'}</p>
                            ${courseCount > 0 ? `<p class="card-text mb-2"><small class="text-muted"><strong>${courseCount}</strong> khóa học</small></p>` : ''}
                            <button class="btn btn-primary btn-sm mt-auto align-self-start view-lp-details-btn" 
                                    data-path-id="${path.id}" data-path-title="${pathTitleForAttr}">
                                Xem chi tiết
                            </button>
                        </div>
                    </div>
                </div>
            `;
                    learningPathsDisplayArea.insertAdjacentHTML('beforeend', pathCardHTML);
                });
                // Initialize tooltips for new buttons
                var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
                var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl)
                })
            }

            // --- Event Delegation for Card Buttons ---
            if (learningPathsDisplayArea) {
                learningPathsDisplayArea.addEventListener('click', (event) => {
                    const editBtn = event.target.closest('.edit-lp-btn');
                    const deleteBtn = event.target.closest('.delete-lp-btn');
                    const viewDetailsBtn = event.target.closest('.view-lp-details-btn');

                    if (editBtn) {
                        const pathId = editBtn.dataset.pathId;
                        if (pathId) openEditModal(parseInt(pathId));
                    } else if (deleteBtn) {
                        const pathId = deleteBtn.dataset.pathId;
                        const pathTitle = deleteBtn.dataset.pathTitle;
                        if (pathId) deleteLearningPath(parseInt(pathId), pathTitle);
                    } else if (viewDetailsBtn) {
                        const pathId = viewDetailsBtn.dataset.pathId;
                        const pathTitle = viewDetailsBtn.dataset.pathTitle;
                        if (pathId) openLearningPathDetailModal(parseInt(pathId), pathTitle);
                    }
                });
            }

            // --- Initial Load ---
            fetchAllSystemCourses(); // Pre-fetch all courses
            fetchAndDisplayLearningPaths(); // Load learning paths
        });
    </script>

    <!-- Core JS -->
    <script src="../assets/vendor/libs/jquery/jquery.js"></script>
    <script src="../assets/vendor/libs/popper/popper.js"></script>
    <script src="../assets/vendor/js/bootstrap.js"></script>
    <script src="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="../assets/vendor/js/menu.js"></script>

    <!-- YOUR CUSTOM SCRIPT -->
    <script type="module" src="script.js"></script>

    <!-- Vendors JS -->
    <script src="../assets/vendor/libs/apex-charts/apexcharts.js"></script>
    <!-- Main JS -->
    <script src="../assets/js/main.js"></script>
    <!-- Page JS -->
    <script src="../assets/js/dashboards-analytics.js"></script>
    <script async defer src="https://buttons.github.io/buttons.js"></script>

    <!-- Inline script for currentUserId, if not handled in script.js -->
    <script>
        // This is a simple way to make userId available.
        // In a real app, this would be set upon login and stored securely.
        let currentGlobalUserId = 1; // Default or placeholder
        const storedUser = localStorage.getItem('user');
        if (storedUser) {
            try {
                const user = JSON.parse(storedUser);
                if (user && user.id) {
                    currentGlobalUserId = user.id;
                }
            } catch (e) {
                console.error("Error parsing user from localStorage for global ID", e);
            }
        }
        // You can access currentGlobalUserId in your script.js
        // Or pass it to functions as needed if script.js is a module and cannot directly access it.
        // For module, better to define it inside script.js or fetch from a global scope if set by non-module script
    </script>
</body>
</html>